{"version":3,"sources":["components/AutoWidth/AutoWidth.js","components/tooltip/tooltip.js","components/ScatterPlot/ScatterPlot.js","utils/collection.js","utils/format.js","constants.js","components/ConnectedScatterPlot/ConnectedScatterPlot.js","components/ColorLegend/ColorLegend.js","components/SmallMultipleConnected/SmallMultipleConnected.js","components/ConfigurePanel/ConfigurePanel.js","components/ConnectedScatterPlotGroups/ConnectedScatterPlotGroups.js","components/BigGraph/BigGraph.js","components/App/App.js","serviceWorker.js","index.js"],"names":["AutoWidth","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","width","defaultRenderWidth","debounceTime","updateWidth","debounce","bind","assertThisInitialized","window","addEventListener","parentMayResize","cancel","removeEventListener","ReactDOM","findDOMNode","domWidth","getResizeDOMNode","offsetWidth","setState","childToRender","child","children","React","cloneElement","react_default","a","createElement","className","Component","defaultProps","tableContent","entries","config","arguments","length","undefined","objectSpread","title","keys","keyFormat","k","valueFormat","v","output","concat","map","join","floatingTooltip","tooltipId","tt","d3","append","attr","html","hideTooltip","style","toNum","str","Number","replace","updatePosition","event","ttw","tth","wscrY","scrollY","wscrX","scrollX","curX","document","all","clientX","pageX","curY","clientY","pageY","ttleft","xOffset","innerWidth","tttop","yOffset","innerHeight","showTooltip","content","ScatterPlot","zooming","showTable","handleLassoSelect","handleZoom","handleZoomingToggle","handleMouseOver","handleMouseOut","handleMouseOverCircle","handleMouseOutCircle","setup","update","d","onFilter","_this$props","xAxis","yAxis","xFunc","yFunc","_this$props2","xScale","yScale","zoomTransform","transform","rescaleX","rescaleY","scale","highlightCircle","chart","selectAll","_this$props3","colorScale","colorBy","tooltipTextFunc","onHover","_this$props4","highlight","tooltip","annotation","el","_this$props5","voronoiDiagram","mouseRadius","mousePos","invert","site","find","data","_this$props6","plotHeight","plotWidth","radius","exactMouse","cRoot","root","g","underlay","classed","that","on","setupZoom","yAxisLabel","xAxisLabel","zoomable","zoom","scaleExtent","padding","left","top","updateChart","updateAnnotation","updateAxes","_this$props7","labels","_this$props8","labelData","filter","country","binding","enter","merge","yValue","position","text","_this$props9","selectedData","hoverData","colorValue","_this$props10","datum","isfinite","key","merged","values","hoverFilter","includes","raise","collection","list","Array","isArray","some","r","exit","remove","_this$props11","xLabel","yLabel","_this$props12","bottom","_this2","_this$props13","height","ref","node","PureComponent","name","brushable","colorByFunc","x","y","addComputedProps","right","xExtent","xPad","Math","round","domain","range","yExtent","yPad","xValue","tickSizeOuter","ticks","pixelJitter","random","size","roundNumber","value","decimals","addCommas","nStr","split","x1","x2","rgx","test","formatNumber","number","thousand","EXTENT","METRICS","hdi","label","display","global","local","sortable","gdp","gni","efree","gini","year","CONFIGS","dataDisplay","options","id","sortOrder","SCATTER_LABELS","United States","Singapore","Italy","Iraq","Sudan","Chad","Algeria","Chile","Switzerland","ConnectedScatterPlot","handleMouseover","handleMouseout","updateCanvas","dataFiltered","line","lineWidth","lineBinding","updateLine","xMetric","yMetric","xLowText","xHighText","yLowText","yHighText","select","dataBackground","sizeScale","lineCanvas","color","opacity","ctx","canvas","getContext","context","setTransform","clearRect","translate","strokeStyle","toString","forEach","index","beginPath","valuesFilter","stroke","canvasStyle","zFunc","devicePixelRatio","curve","tension","changeInclude","ColorLegend","textAnchor","cx","cy","fill","years","dotWidth","renderYear","push","SmallMultipleConnected","chartData","chartIndex","zLabel","dataGrouped","reactstrap_es","sm","components_AutoWidth_AutoWidth","components_ConnectedScatterPlot_ConnectedScatterPlot","region","components_ColorLegend_ColorLegend","renderLegend","i","renderRegion","renderChart","direction","sort","sortData","threshold","filterData","_tooltipData","defineProperty","indexOf","objs","o","ConfigurePanel","console","log","configs","toggle","click","dataDisplayIndex","dropdownOpen","selectIndex","selectedId","dropdownId","prevState","option","optionIndex","onClick","dropdownState","items","isOpen","caret","renderDropdown","ConnectedScatterPlotGroups","hover","b","lineColor","hoverCountry","dotColor","arc","PI","fillStyle","allData","meanX","meanY","minX","maxX","minY","maxY","xMin","xMax","yMin","yMax","BigGraph","components_ConnectedScatterPlotGroups_ConnectedScatterPlotGroups","renderBigGraph","STRING_COLUMNS","ROUND_COLUMNS","gdp_per_cap","NULL_STRING","normalizeMinMax","normAttr","minData","maxData","NaN","processData","population","App","focusYear","scatterHover","handleScatterHover","handleConfigClick","configId","valueId","changesPath","process","getData","then","groupData","processGroupedData","_this$state","displayData","components_ScatterPlot_ScatterPlot","_this$state2","_tooltipData2","_this$state3","_configs$dataDisplay$","_configs$dataDisplay$2","slicedToArray","components_BigGraph_BigGraph","_this$state4","_configs$dataDisplay$3","_configs$dataDisplay$4","components_SmallMultipleConnected_SmallMultipleConnected","components_ConfigurePanel_ConfigurePanel","href","target","rel","cite","md","renderScatterGNIvsKDI","renderScatterGNIvsEfree","renderConfigPanel","renderSmallMult","Boolean","location","hostname","match","render","components_App_App","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.927411b9.chunk.js","sourcesContent":["/**\n * @copyright 2018 Zymergen\n */\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport debounce from 'lodash.debounce';\n\nconst propTypes = {\n  children: PropTypes.object,\n\n  /* The amount of delay between debounced calls (default: 100) */\n  debounceTime: PropTypes.number,\n\n  /* If set, the default width is set to this value and the child is\n     rendered. If null, the child is not rendered until a width is provided */\n  defaultRenderWidth: PropTypes.number,\n\n  /* If true, the component checks on componentDidUpdate to see if it needs to resize */\n  parentMayResize: PropTypes.bool,\n};\n\nconst defaultProps = {\n  parentMayResize: false,\n  defaultRenderWidth: null,\n  debounceTime: 100,\n};\n\n/**\n * Component for automatically setting a width prop to the DOM\n * node of the first child. Note that checking offsetWidth is a\n * somewhat expensive operation (forced reflow), so try and leave\n * `parentMayResize` false if you are having performance issues.\n *\n * Example usage:\n * <AutoWidth>\n *   <MyComponent />\n * </AutoWidth>\n *\n * MyComponent gets a `width` prop set.\n *\n */\nclass AutoWidth extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      width: props.defaultRenderWidth,\n    };\n\n    if (props.debounceTime) {\n      this.updateWidth = debounce(this.updateWidth.bind(this), props.debounceTime);\n    } else {\n      this.updateWidth = this.updateWidth.bind(this);\n    }\n  }\n\n  componentDidMount() {\n    this.updateWidth();\n    window.addEventListener('resize', this.updateWidth);\n  }\n\n  componentDidUpdate() {\n    const { parentMayResize } = this.props;\n\n    // have to update width of the parent can cause a resize without a window resize\n    // e.g. something collapses or expands.\n    if (parentMayResize) {\n      this.updateWidth();\n    }\n  }\n\n  componentWillUnmount() {\n    this.updateWidth.cancel();\n    window.removeEventListener('resize', this.updateWidth);\n  }\n\n  getResizeDOMNode() {\n    return ReactDOM.findDOMNode(this);\n  }\n\n  // Call set state to update the width so it starts an update of the child component\n  updateWidth() {\n    const { width } = this.state;\n    const domWidth = this.getResizeDOMNode().offsetWidth;\n    if (width !== domWidth) {\n      this.setState({\n        width: domWidth,\n      });\n    }\n  }\n\n  render() {\n    const { width } = this.state;\n\n    if (process.env.NODE_ENV !== 'production' && React.Children.count(this.props.children) > 1) {\n      console.warn('AutoWidth only works with a single child element.');\n    }\n\n    const child = this.props.children;\n    let childToRender;\n\n    // if we have a child and a width is provided, render the child with the width as a prop\n    if (child && width != null) {\n      childToRender = React.cloneElement(child, { width: this.state.width });\n    }\n\n    // we rely on this div getting the full width from the browser's layout\n    // and read its offsetWidth to set as the width to the child component.\n    return <div className=\"auto-width\">{childToRender}</div>;\n  }\n}\n\nAutoWidth.propTypes = propTypes;\nAutoWidth.defaultProps = defaultProps;\n\nexport default AutoWidth;\n","import * as d3 from \"d3\";\nimport \"./tooltip.scss\";\n\n/**\n * Format an object into a table for tooltip output.\n *\n * @param {Object} entries Object of items to display as a tooltip table.\n * @param {Object} config Configuration object that modifies the table generation.\n *  Possible values are:\n *  title: optional title for table\n *  keys: if provided, only display data from entries associated with these keys.\n *    This also can be used to specify the order of the data in the table.\n *    If not provided, all keys from `entries` are displayed.\n *  keyFormat: formatting function that takes a key and outputs a string to be displayed.\n *  valueFormat: formatting function that takes a value and outputs a string to be displayed.\n */\nexport function tableContent(entries, config = {}) {\n  const defaultConfig = {\n    title: null,\n    keys: null,\n    keyFormat: k => k,\n    valueFormat: v => v\n  };\n  config = { ...defaultConfig, ...config };\n  config.keys = config.keys || Object.keys(entries);\n  let output = \"<div>\";\n  if (config.title) {\n    output += `<h2>${config.title}</h2>`;\n  }\n  output += \"<table><tbody>\";\n  const rows = config.keys.map(k => {\n    if (k in entries) {\n      return `<tr><td>${config.keyFormat(k)}</td><td>${config.valueFormat(\n        entries[k]\n      )}</td></tr>`;\n    }\n    return \"\";\n  });\n  output += rows.join(\"\");\n  output += \"</tbody></table></div>\";\n  return output;\n}\n\n/**\n * Format an object into a series of spans for tooltip output.\n *\n * @param {Object} entries\n * @param {Function} keyFormat\n */\nexport function spanContent(entries) {\n  const content = Object.keys(entries).map(k => {\n    return `<span class='name'>${k}: </span><span class='value'>${\n      entries[k]\n    }</span>`;\n  });\n\n  return content.join(\"<br/>\");\n}\n\n/*\n * Creates tooltip with provided id that\n * floats on top of visualization.\n * Most styling is expected to come from CSS\n * so check out bubble_chart.scss for more details.\n */\nexport function floatingTooltip(tooltipId, width) {\n  // Local variable to hold tooltip div for\n  // manipulation in other functions.\n  var tt = d3\n    .select(\"body\")\n    .append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .attr(\"id\", tooltipId)\n    .html(\"\");\n\n  // Set a width if it is provided.\n  if (width) {\n    tt.style(\"width\", width);\n  }\n\n  // Initially it is hidden.\n  hideTooltip();\n\n  /*\n   * Display tooltip with provided content.\n   *\n   * content is expected to be HTML string.\n   *\n   * event is d3.event for positioning.\n   */\n  function showTooltip(content, event) {\n    tt.style(\"opacity\", 1.0)\n      .style(\"pointer-events\", \"all\")\n      .html(content);\n\n    updatePosition(event);\n  }\n\n  /*\n   * Hide the tooltip div.\n   */\n  function hideTooltip() {\n    tt.style(\"opacity\", 0.0).style(\"pointer-events\", \"none\");\n  }\n\n  function toNum(str) {\n    return Number(str.replace(/[^\\d.-]/g, \"\"));\n  }\n\n  /*\n   * Figure out where to place the tooltip\n   * based on d3 mouse evenggt.\n   */\n  function updatePosition(event) {\n    var xOffset = 35;\n    var yOffset = -60;\n\n    var ttw = toNum(tt.style(\"width\"));\n    var tth = toNum(tt.style(\"height\"));\n\n    var wscrY = window.scrollY;\n    var wscrX = window.scrollX;\n\n    var curX = document.all ? event.clientX + wscrX : event.pageX;\n    var curY = document.all ? event.clientY + wscrY : event.pageY;\n    var ttleft =\n      curX - wscrX + xOffset * 2 + ttw > window.innerWidth\n        ? curX - ttw - xOffset\n        : curX + xOffset;\n\n    if (ttleft < wscrX + xOffset) {\n      ttleft = wscrX + xOffset;\n    }\n\n    var tttop =\n      curY - wscrY + yOffset * 2 + tth > window.innerHeight\n        ? curY - tth - yOffset * 2\n        : curY + yOffset;\n\n    if (tttop < wscrY + yOffset) {\n      tttop = curY + yOffset;\n    }\n\n    tt.style(\"top\", tttop + \"px\").style(\"left\", ttleft + \"px\");\n  }\n\n  return {\n    showTooltip: showTooltip,\n    hideTooltip: hideTooltip,\n    updatePosition: updatePosition\n  };\n}\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport addComputedProps from \"react-computed-props\";\nimport isfinite from \"lodash.isfinite\";\nimport * as d3 from \"d3\";\n\nimport { includesAny } from \"../../utils/collection\";\nimport { floatingTooltip } from \"../tooltip/tooltip\";\n\nimport \"./ScatterPlot.scss\";\n\nfunction chartProps(props) {\n  const {\n    data,\n    height,\n    width,\n    xFunc,\n    yFunc,\n    colorByFunc,\n    colorScale,\n    exactMouse\n  } = props;\n\n  const padding = {\n    top: 20,\n    right: 20,\n    bottom: 50,\n    left: 60\n  };\n\n  const plotWidth = width - padding.left - padding.right;\n  const plotHeight = height - padding.top - padding.bottom;\n\n  const xExtent = d3.extent(data, xFunc);\n  const xPad = Math.round((xExtent[1] - xExtent[0]) / 20);\n  const xScale = d3\n    .scaleLinear()\n    .domain([xExtent[0] - xPad, xExtent[1] + xPad])\n    .range([0, plotWidth]);\n\n  const yExtent = d3.extent(data, yFunc);\n  const yPad = (yExtent[1] - yExtent[0]) / 20;\n  const yScale = d3\n    .scaleLinear()\n    .domain([yExtent[0] - yPad, yExtent[1] + yPad])\n    .range([plotHeight, 0]);\n\n  const xValue = d => xScale(xFunc(d));\n  const yValue = d => yScale(yFunc(d));\n  const colorValue = d =>\n    colorByFunc(d) ? colorScale(colorByFunc(d)) : \"#888\";\n\n  const yAxis = d3\n    .axisLeft(yScale)\n    .tickSizeOuter(0)\n    .ticks(4);\n  const xAxis = d3\n    .axisBottom(xScale)\n    .tickSizeOuter(0)\n    .ticks(4);\n\n  let voronoiDiagram = d3.voronoi()([]);\n\n  if (!exactMouse) {\n    const pixelJitter = () => Math.random() - 0.5;\n    voronoiDiagram = d3\n      .voronoi()\n      .x(d => xValue(d) + pixelJitter())\n      .y(d => yValue(d) + pixelJitter())\n      .size([plotWidth, plotHeight])(data);\n  }\n\n  const mouseRadius = plotWidth / 10;\n\n  return {\n    plotWidth,\n    plotHeight,\n    padding,\n    colorValue,\n    xScale,\n    yScale,\n    xValue,\n    yValue,\n    xAxis,\n    yAxis,\n    voronoiDiagram,\n    mouseRadius\n  };\n}\n\n/**\n * Scatter Plot component used to visualize two variables in the same chart.\n * Provides brushing capabilities for selecting subsets of data points.\n * Also provides zooming and hovering capabilities.\n */\nclass ScatterPlot extends PureComponent {\n  static propTypes = {\n    /**\n     * Boolean to enable/disable brushing interaction.\n     */\n    brushable: PropTypes.bool,\n\n    /**\n     * Function to extract attribute used to color dots with.\n     * Used in conjunction with `colorScale` a la:\n     * `colorScale(colorByFunc(d))`.\n     */\n    colorByFunc: PropTypes.func,\n\n    /**\n     * D3-style color scale function to color dots by.\n     */\n    colorScale: PropTypes.func,\n\n    /**\n     * Array of data objects to plot. x,y, and color values\n     * are extracted from each object in this array using\n     * xFunc, yFunc, and colorByFunc, respectively.\n     */\n    data: PropTypes.array,\n    labels: PropTypes.object,\n\n    /**\n     * A nice UX feature is when mousing over a plot,\n     * the nearest point to the mouse cursor can be detected\n     * using a voronoi diagram and its tooltip can be displayed\n     * without having to explicitly mouse onto that point.\n     * Unfortunately, these plots are flexible enough to allow data\n     * that is un-voronoi-able... causing crashing behavior. So,\n     * this approach (in certain contexts) needs to be abandoned.\n     * This boolean controls if 'exact mouse' (no voronoi) should\n     * be used for mouse-over or not.\n     * @default true\n     */\n    exactMouse: PropTypes.bool,\n\n    /**\n     * Height of component\n     */\n    height: PropTypes.number,\n\n    /**\n     * Values being hovered on.\n     */\n    hoverData: PropTypes.shape({\n      values: PropTypes.array\n    }),\n\n    /**\n     * Unique name of plot. Used for\n     * maximization interaction.\n     */\n    name: PropTypes.string,\n\n    /**\n     * Callback for brushing interaction.\n     */\n    onFilter: PropTypes.func,\n\n    /**\n     *\n     */\n    onHover: PropTypes.func,\n\n    /**\n     * Radius of dots.\n     * @default 4\n     */\n    radius: PropTypes.number,\n\n    /**\n     * Values selected.\n     */\n    selectedData: PropTypes.shape({\n      values: PropTypes.array\n    }),\n\n    /**\n     * Function used to generate tooltip text.\n     * function is provided data object.\n     */\n    tooltipTextFunc: PropTypes.func,\n\n    /**\n     * Width of component.\n     */\n    width: PropTypes.number,\n\n    /**\n     * Accessor function for x value of data object to display.\n     */\n    xFunc: PropTypes.func,\n\n    /**\n     * x-axis label.\n     */\n    xLabel: PropTypes.string,\n\n    /**\n     * Accessor function for y value of data object to display.\n     */\n    yFunc: PropTypes.func,\n\n    /**\n     * y-axis label.\n     */\n    yLabel: PropTypes.string,\n\n    /**\n     * Boolean controlling if chart is zoomable or not.\n     * @default true\n     */\n    zoomable: PropTypes.bool\n  };\n\n  static defaultProps = {\n    data: [],\n    labels: {},\n    name: \"scatter\",\n    brushable: true,\n    colorByFunc: () => {},\n    height: 400,\n    hoverData: null,\n    selectedData: null,\n    width: 300,\n    onFilter: () => {},\n    colorScale: () => \"#ddd\",\n    xFunc: d => d.x,\n    yFunc: d => d.y,\n    radius: 4,\n    xLabel: \"\",\n    yLabel: \"\",\n    zoomable: false,\n    exactMouse: false\n  };\n\n  /**\n   *\n   */\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      zooming: false,\n      showTable: false\n    };\n\n    this.handleLassoSelect = this.handleLassoSelect.bind(this);\n    this.handleZoom = this.handleZoom.bind(this);\n    this.handleZoomingToggle = this.handleZoomingToggle.bind(this);\n    this.handleMouseOver = this.handleMouseOver.bind(this);\n    this.handleMouseOut = this.handleMouseOut.bind(this);\n    this.handleMouseOverCircle = this.handleMouseOverCircle.bind(this);\n    this.handleMouseOutCircle = this.handleMouseOutCircle.bind(this);\n  }\n\n  /**\n   * When the react component mounts, setup the d3 vis\n   */\n  componentDidMount() {\n    this.setup();\n  }\n\n  /**\n   * When the react component updates, update the d3 vis\n   */\n  componentDidUpdate() {\n    this.update();\n  }\n\n  /**\n   *\n   */\n  handleLassoSelect(d) {\n    this.props.onFilter(d);\n  }\n\n  /**\n   *\n   */\n  handleZoom() {\n    const { xAxis, yAxis, xFunc, yFunc } = this.props;\n    let { xScale, yScale } = this.props;\n\n    // record zoom transform to be used in\n    // other interaction callbacks.\n    this.zoomTransform = d3.event.transform;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    this.yAxis.call(yAxis.scale(yScale));\n\n    this.xAxis.call(xAxis.scale(xScale));\n\n    const xValue = d => xScale(xFunc(d));\n    const yValue = d => yScale(yFunc(d));\n\n    this.highlightCircle(null);\n\n    this.chart\n      .selectAll(\".dot\")\n      .attr(\"cx\", xValue)\n      .attr(\"cy\", yValue);\n  }\n\n  /**\n   *\n   */\n  handleZoomingToggle() {\n    const { zooming } = this.state;\n    this.setState({\n      zooming: !zooming\n    });\n  }\n\n  /**\n   *\n   */\n  highlightCircle(d) {\n    const {\n      xFunc,\n      yFunc,\n      colorScale,\n      colorBy,\n      tooltipTextFunc,\n      onHover\n    } = this.props;\n    let { xScale, yScale } = this.props;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    if (!d) {\n      this.highlight.style(\"display\", \"none\");\n      this.tooltip.hideTooltip();\n      this.annotation.attr(\"opacity\", 1.0);\n    } else {\n      this.highlight\n        .style(\"display\", \"\")\n        .style(\"stroke\", colorScale(d[colorBy]))\n        .attr(\"cx\", xScale(xFunc(d)))\n        .attr(\"cy\", yScale(yFunc(d)));\n      if (tooltipTextFunc) {\n        this.tooltip.showTooltip(tooltipTextFunc(d), d3.event);\n      }\n      this.annotation.attr(\"opacity\", 0.3);\n    }\n\n    if (onHover) {\n      onHover(d);\n    }\n  }\n\n  /**\n   *\n   */\n  handleMouseOver(el) {\n    const { voronoiDiagram, mouseRadius } = this.props;\n\n    let mousePos = d3.mouse(el);\n    mousePos = this.zoomTransform.invert(mousePos);\n    const site = voronoiDiagram.find(mousePos[0], mousePos[1], mouseRadius);\n    this.highlightCircle(site && site.data);\n  }\n\n  /**\n   *\n   */\n  handleMouseOut() {\n    this.highlightCircle(null);\n  }\n\n  /**\n   *\n   */\n  handleMouseOverCircle(d) {\n    this.highlightCircle(d);\n  }\n\n  /**\n   *\n   */\n  handleMouseOutCircle() {\n    this.highlightCircle(null);\n  }\n\n  /**\n   *\n   */\n  setup() {\n    const { plotHeight, plotWidth, radius, exactMouse } = this.props;\n    const cRoot = d3.select(this.root);\n\n    this.g = cRoot.append(\"g\");\n\n    this.underlay = this.g\n      .append(\"rect\")\n      .classed(\"underlay\", true)\n      .attr(\"width\", plotWidth)\n      .attr(\"height\", plotHeight)\n      .style(\"fill\", \"white\");\n\n    const that = this;\n    if (!exactMouse) {\n      this.underlay\n        .on(\"mousemove\", function(d) {\n          that.handleMouseOver(this, d);\n        })\n        .on(\"mouseleave\", function() {\n          that.handleMouseOut();\n        });\n    }\n\n    this.setupZoom(this.underlay);\n\n    this.chart = this.g.append(\"g\").classed(\"chart-group\", true);\n    this.tooltip = floatingTooltip(\"_tooltip\");\n\n    this.highlight = this.g\n      .append(\"circle\")\n      .attr(\"class\", \"highlight-circle\")\n      .attr(\"r\", radius + 2)\n      .style(\"fill\", \"none\")\n      .style(\"display\", \"none\");\n\n    this.annotation = this.g\n      .append(\"g\")\n      .classed(\"annotation\", true)\n      .attr(\"pointer-events\", \"none\");\n\n    this.xAxis = this.g.append(\"g\").classed(\"x-axis\", true);\n    this.yAxis = this.g.append(\"g\").classed(\"y-axis\", true);\n    this.yAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.xAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.update();\n  }\n\n  /**\n   *\n   */\n  setupZoom(underlay) {\n    const { zoomable } = this.props;\n    this.zoomTransform = d3.zoomIdentity;\n\n    if (zoomable) {\n      this.zoom = d3\n        .zoom()\n        .scaleExtent([1 / 4, 8])\n        .on(\"zoom\", this.handleZoom);\n\n      underlay.call(this.zoom);\n    }\n  }\n\n  /**\n   *\n   */\n  update() {\n    const { padding } = this.props;\n    this.g.attr(\"transform\", `translate(${padding.left} ${padding.top})`);\n\n    this.updateChart();\n    this.updateAnnotation();\n    this.updateAxes();\n  }\n\n  updateAnnotation() {\n    const { data, labels, xFunc, yFunc } = this.props;\n    let { xScale, yScale } = this.props;\n\n    const labelData = data.filter(d => labels[d.country]);\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    const xValue = d => xScale(xFunc(d));\n    const yValue = d => yScale(yFunc(d));\n\n    const binding = this.annotation\n      .selectAll(\".label\")\n      .data(labelData, d => d.country);\n\n    const enter = binding\n      .enter()\n      .append(\"text\")\n      .classed(\"label\", true);\n    const merged = enter.merge(binding);\n\n    merged\n      .attr(\"x\", xValue)\n      .attr(\"y\", d => yValue(d))\n      .attr(\"dy\", d => (labels[d.country].position === \"below\" ? 15 : 3))\n      .attr(\"dx\", d => (labels[d.country].position === \"below\" ? null : 8))\n      .attr(\"text-anchor\", d =>\n        labels[d.country].position === \"below\" ? \"middle\" : \"start\"\n      )\n      .text(d => d.country);\n  }\n\n  /**\n   *\n   */\n  updateChart() {\n    const {\n      data,\n      selectedData,\n      hoverData,\n      xFunc,\n      yFunc,\n      colorValue,\n      radius,\n      exactMouse\n    } = this.props;\n\n    let { xScale, yScale } = this.props;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    const xValue = d => xScale(xFunc(d));\n    const yValue = d => yScale(yFunc(d));\n\n    const binding = this.chart\n      .selectAll(\".dot\")\n      .data(\n        data.filter(datum => isfinite(xFunc(datum)) && isfinite(yFunc(datum))),\n        datum => datum.key\n      );\n\n    const enter = binding\n      .enter()\n      .append(\"circle\")\n      .classed(\"dot\", true);\n\n    const merged = enter.merge(binding);\n\n    merged\n      .attr(\"cx\", xValue)\n      .attr(\"cy\", yValue)\n      .attr(\"r\", radius)\n      .attr(\"fill\", colorValue);\n\n    if (exactMouse) {\n      merged\n        .on(\"mouseover\", this.handleMouseOverCircle)\n        .on(\"mouseout\", this.handleMouseOutCircle);\n    } else {\n      merged.style(\"pointer-events\", \"none\");\n    }\n\n    merged\n      .classed(\"highlight\", false)\n      .classed(\"dim\", false)\n      .classed(\"selected\", false);\n\n    if (hoverData && hoverData.values.length > 0) {\n      const hoverFilter = d => hoverData.values.includes(d.key);\n\n      merged\n        .classed(\"highlight\", false)\n        .classed(\"dim\", true)\n        .filter(hoverFilter)\n        .classed(\"highlight\", true)\n        .classed(\"dim\", false)\n        .raise()\n        .filter(hoverFilter)\n        .classed(\"selected\", true)\n        .raise();\n    }\n\n    if (selectedData && selectedData.values && selectedData.values.length > 0) {\n      merged\n        .filter(\n          d =>\n            d[selectedData.key] &&\n            includesAny(d[selectedData.key], selectedData.values)\n        )\n        .classed(\"highlight\", true)\n        .classed(\"dim\", false)\n        .raise();\n    }\n\n    binding.exit().remove();\n  }\n\n  /**\n   *\n   */\n  updateAxes() {\n    const {\n      xAxis,\n      yAxis,\n      xLabel,\n      yLabel,\n      plotHeight,\n      plotWidth,\n      padding\n    } = this.props;\n\n    let { xScale, yScale } = this.props;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    this.xAxis\n      .attr(\"transform\", `translate(${0}, ${plotHeight})`)\n      .call(xAxis.scale(xScale));\n\n    this.yAxis.call(yAxis.scale(yScale));\n\n    this.yAxisLabel\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight / 2} ${-padding.left + 18})`\n      )\n      .text(yLabel);\n\n    this.xAxisLabel\n      .attr(\n        \"transform\",\n        `translate(${plotWidth / 2} ${plotHeight +\n          padding.top +\n          padding.bottom / 3})`\n      )\n      .text(xLabel);\n  }\n\n  /**\n   *\n   */\n  render() {\n    const { height, width } = this.props;\n\n    // keeps plot from overlapping on small screens - as\n    // elements are absolutely positioned within.\n    const style = { height: height };\n\n    return (\n      <div className=\"ScatterPlot\">\n        <div className=\"chart-brush\" style={style}>\n          <svg\n            className=\"chart\"\n            ref={node => {\n              this.root = node;\n            }}\n            height={height}\n            width={width}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default addComputedProps(chartProps)(ScatterPlot);\n","/**\n * Returns true if collection includes any in list\n * @param  {Array} collection Array of values to search\n * @param  {Array} list values to check for\n * @returns {Bool} true if collection contains any\n *  of the elements in list\n */\nexport function includesAny(collection, list) {\n  if (!collection || !list) {\n    return false;\n  }\n\n  if (!Array.isArray(collection)) {\n    collection = [collection];\n  }\n\n  // array.some tests whether at least one element\n  // in the array passes the test\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some\n  return collection.some(r => list.includes(r));\n}\n","/**\n * Round a value to a given number of decimals\n * @param {Number} value Value to round.\n * @param {Number} decimals decimals to round to.\n * @return {Number} rounded number\n */\nexport function roundNumber(value, decimals) {\n  return Number(`${Math.round(`${value}e${decimals}`)}e-${decimals}`);\n}\n\n/**\n * Add commas to a number to make it look better\n * @param {Number} nStr to add commas to\n * @return {String} number with commas\n */\nexport function addCommas(nStr) {\n  if (!nStr) {\n    nStr = 0;\n  }\n  nStr = +nStr + \"\";\n  const x = nStr.split(\".\");\n  let x1 = x[0];\n  const x2 = x.length > 1 ? `.${x[1]}` : \"\";\n  const rgx = /(\\d+)(\\d{3})/;\n  while (rgx.test(x1)) {\n    x1 = x1.replace(rgx, \"$1,$2\");\n  }\n  return x1 + x2;\n}\n\n/**\n * @param {Number} number Number to format\n * @return {String} number with commas and M/B instaed of million / billion\n */\nexport function formatNumber(number, thousand = false) {\n  if (!number) {\n    number = 0;\n  }\n  if (number > 999999999) {\n    number = roundNumber(number / 1000000000.0, 1);\n    return `${addCommas(number)}B`;\n  } else if (number > 999999) {\n    number = roundNumber(number / 1000000.0, 1);\n    return `${addCommas(number)}M`;\n  } else if (number > 999 && thousand) {\n    number = roundNumber(number / 1000.0, 1);\n    return `${addCommas(number)}K`;\n  }\n  return addCommas(number);\n}\n","export const EXTENT = [-0.05, 1.05];\n\nexport const METRICS = {\n  hdi: {\n    label: \"Human Development Index\",\n    display: \"hdi\",\n    global: \"hdi_norm\",\n    local: \"hdi_norm_local\",\n    sortable: \"hdi_max\"\n  },\n  gdp: {\n    label: \"GDP per Capita\",\n    display: \"gdp_per_cap\",\n    global: \"gdp_norm\",\n    local: \"gdp_norm_local\",\n    sortable: \"gdp_max\"\n  },\n  gni: {\n    label: \"GNI per Capita\",\n    display: \"gni_per_cap\",\n    global: \"gni_norm\",\n    local: \"gni_norm_local\",\n    sortable: \"gni_max\"\n  },\n  efree: {\n    label: \"Economic Freedom\",\n    display: \"efree\",\n    global: \"efree_norm\",\n    local: \"efree_norm_local\",\n    sortable: \"efree_max\"\n  },\n  gini: {\n    label: \"Gini Index\",\n    display: \"gini\",\n    global: \"gini_norm\",\n    local: \"gini_norm_local\",\n    sortable: \"gini_max\"\n  },\n  year: { label: \"Year\", display: \"year\" }\n};\n\nexport const CONFIGS = {\n  dataDisplay: {\n    options: [\n      { label: \"HDI vs GDP\", id: \"hdi_gdp\" },\n      { label: \"Economic Freedom vs GDP\", id: \"efree_gdp\" },\n      { label: \"Gini vs GDP\", id: \"gini_gdp\" },\n      { label: \"HDI vs Economic Freedom\", id: \"hdi_efree\" },\n      { label: \"HDI vs Gini\", id: \"hdi_gini\" },\n      { label: \"Gini vs Economic Freedom\", id: \"gini_efree\" }\n    ]\n  },\n  sortOrder: {\n    options: [\n      { label: \"By HDI\", id: \"hdi\" },\n      { label: \"By GDP\", id: \"gdp\" },\n      { label: \"By Economic Freedom\", id: \"efree\" },\n      { label: \"By Gini Index\", id: \"gini\" },\n      { label: \"By Region\", id: \"region\" },\n      { label: \"Alphabetically\", id: \"alpha\" }\n    ]\n  },\n  scale: {\n    options: [\n      { label: \"Country-level\", id: \"local\" },\n      { label: \"Global\", id: \"global\" }\n    ]\n  }\n};\n\nexport const SCATTER_LABELS = {\n  hdi: {\n    \"United States\": { id: \"United States\", position: \"below\" },\n    Singapore: { id: \"Singapore\", position: \"below\" },\n    Italy: { id: \"Italy\", position: \"below\" },\n    Iraq: { id: \"Italy\", position: \"below\" },\n    Sudan: { id: \"Italy\", position: \"right\" },\n    Chad: { id: \"Italy\", position: \"right\" }\n  },\n  efree: {\n    \"United States\": { id: \"United States\", position: \"below\" },\n    Singapore: { id: \"Singapore\", position: \"below\" },\n    Italy: { id: \"Italy\", position: \"below\" },\n    Iraq: { id: \"Iraq\", position: \"below\" },\n    Algeria: { id: \"Algeria\", position: \"below\" },\n    Chile: { id: \"Chile\", position: \"below\" },\n    Switzerland: { id: \"Switzerland\", position: \"below\" }\n  }\n};\n","import React, { PureComponent } from \"react\";\nimport PropTypes from \"prop-types\";\nimport addComputedProps from \"react-computed-props\";\nimport * as d3 from \"d3\";\nimport isfinite from \"lodash.isfinite\";\nimport { floatingTooltip } from \"../tooltip/tooltip\";\n\nimport \"./ConnectedScatterPlot.scss\";\n\n/**\n *\n * @param {*} props\n */\nfunction chartProps(props) {\n  const { data, xFunc, yFunc, zFunc, colorScale, height, width, scale } = props;\n\n  let { xExtent, yExtent } = props;\n\n  const padding = {\n    top: 20,\n    right: 20,\n    bottom: 40,\n    left: 40\n  };\n\n  // scaling for retina displays\n  let sizeScale = 1.0;\n  if (window.devicePixelRatio) {\n    sizeScale = window.devicePixelRatio;\n  }\n\n  const radius = scale === \"local\" ? 5 : 2;\n  const lineWidth = scale === \"local\" ? 3 : 1;\n\n  const plotWidth = width - padding.left - padding.right;\n  const plotHeight = height - padding.top - padding.bottom;\n\n  const dataFiltered = data.filter(\n    datum => isfinite(xFunc(datum)) && isfinite(yFunc(datum))\n  );\n\n  xExtent = xExtent || d3.extent(data, xFunc);\n  const xScale = d3\n    .scaleLinear()\n    .domain(xExtent)\n    .range([0, plotWidth]);\n\n  yExtent = yExtent || d3.extent(data, yFunc);\n  const yScale = d3\n    .scaleLinear()\n    .domain(yExtent)\n    .range([plotHeight, 0]);\n\n  const xValue = d => xScale(xFunc(d));\n  const yValue = d => yScale(yFunc(d));\n\n  const line = d3\n    .line()\n    .x(xValue)\n    .y(yValue)\n    .curve(d3.curveCardinal.tension(0.3));\n\n  const lineCanvas = d3\n    .line()\n    .x(xValue)\n    .y(yValue)\n    .curve(d3.curveCardinal.tension(0.3));\n\n  let colorValue = d => \"#ddd\";\n  if (colorScale) {\n    colorValue = d => colorScale(zFunc(d));\n  }\n\n  let voronoiDiagram = null;\n\n  if (data && data.length > 0) {\n    const pixelJitter = () => Math.random() - 0.5;\n    voronoiDiagram = d3\n      .voronoi()\n      .x(d => xValue(d) + pixelJitter())\n      .y(d => yValue(d) + pixelJitter())\n      .size([plotWidth, plotHeight])(dataFiltered);\n  }\n\n  const mouseRadius = plotWidth / 3;\n\n  const yAxis = d3.axisLeft(yScale).tickSizeOuter(0);\n  const xAxis = d3.axisBottom(xScale).tickSizeOuter(0);\n\n  return {\n    dataFiltered,\n    line,\n    lineCanvas,\n    padding,\n    plotHeight,\n    plotWidth,\n    xScale,\n    yScale,\n    xValue,\n    yValue,\n    colorValue,\n    radius,\n    lineWidth,\n    voronoiDiagram,\n    mouseRadius,\n    xAxis,\n    yAxis,\n    sizeScale\n  };\n}\n\n/**\n *\n */\nclass ConnectedScatterPlot extends PureComponent {\n  static propTypes = {\n    data: PropTypes.array,\n    name: PropTypes.string,\n    radius: PropTypes.number,\n    scale: PropTypes.string,\n    xFunc: PropTypes.func,\n    yFunc: PropTypes.func,\n    xLabel: PropTypes.string,\n    yLabel: PropTypes.string,\n    xExtent: PropTypes.array,\n    yExtent: PropTypes.array,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    tooltipTextFunc: PropTypes.func\n  };\n\n  static defaultProps = {\n    data: [],\n    radius: 4,\n    height: 300,\n    width: 300,\n    name: \"\",\n    xFunc: d => d.x,\n    yFunc: d => d.x,\n    xLabel: \"\",\n    yLabel: \"\",\n    tooltipTextFunc: d => \"\",\n    colorScale: () => \"#ddd\"\n  };\n\n  /**\n   *\n   */\n  constructor(props) {\n    super(props);\n\n    this.handleMouseover = this.handleMouseover.bind(this);\n    this.handleMouseout = this.handleMouseout.bind(this);\n  }\n\n  /**\n   * When the react component mounts, setup the d3 vis\n   */\n  componentDidMount() {\n    this.setup();\n  }\n\n  /**\n   * When the react component updates, update the d3 vis\n   */\n  componentDidUpdate() {\n    this.update();\n  }\n\n  /**\n   *\n   */\n  handleMouseover(el) {\n    const { voronoiDiagram, mouseRadius } = this.props;\n\n    let mousePos = d3.mouse(el);\n    mousePos = this.zoomTransform.invert(mousePos);\n    const site = voronoiDiagram.find(mousePos[0], mousePos[1], mouseRadius);\n    this.highlightCircle(site && site.data);\n  }\n\n  /**\n   *\n   */\n  handleMouseout(el) {\n    this.highlightCircle(null);\n  }\n\n  /**\n   *\n   */\n  highlightCircle(d) {\n    const {\n      xFunc,\n      yFunc,\n      colorScale,\n      colorBy,\n      tooltipTextFunc,\n      onHover\n    } = this.props;\n    let { xScale, yScale } = this.props;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    if (!d) {\n      this.highlight.style(\"display\", \"none\");\n      this.tooltip.hideTooltip();\n    } else {\n      this.highlight\n        .style(\"display\", \"\")\n        .style(\"stroke\", colorScale(d[colorBy]))\n        .attr(\"cx\", xScale(xFunc(d)))\n        .attr(\"cy\", yScale(yFunc(d)));\n      if (tooltipTextFunc) {\n        this.tooltip.showTooltip(tooltipTextFunc(d), d3.event);\n      }\n    }\n\n    if (onHover) {\n      onHover(d);\n    }\n  }\n\n  /**\n   *\n   */\n  setup() {\n    const { plotWidth, plotHeight, radius } = this.props;\n\n    this.zoomTransform = d3.zoomIdentity;\n\n    const cRoot = d3.select(this.root);\n\n    this.g = cRoot.append(\"g\");\n\n    const that = this;\n    this.underlay = this.g\n      .append(\"rect\")\n      .classed(\"underlay\", true)\n      .attr(\"width\", plotWidth)\n      .attr(\"height\", plotHeight)\n      .style(\"fill\", \"white\")\n      .style(\"opacity\", 0.001)\n      .on(\"mousemove\", function(d) {\n        that.handleMouseover(this, d);\n      })\n      .on(\"mouseleave\", function() {\n        that.handleMouseout();\n      });\n    this.chart = this.g.append(\"g\").classed(\"chart-group\", true);\n    this.tooltip = floatingTooltip(\"_tooltip\");\n\n    this.highlight = this.g\n      .append(\"circle\")\n      .attr(\"class\", \"highlight-circle\")\n      .attr(\"r\", radius + 2)\n      .style(\"fill\", \"none\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"display\", \"none\");\n\n    this.xAxis = this.g\n      .append(\"g\")\n      .classed(\"x-axis\", true)\n      .style(\"pointer-events\", \"none\");\n\n    this.xAxis.append(\"line\").classed(\"bar\", true);\n    this.xAxis.append(\"text\").classed(\"low\", true);\n    this.xAxis.append(\"text\").classed(\"high\", true);\n\n    this.yAxis = this.g\n      .append(\"g\")\n      .classed(\"y-axis\", true)\n      .style(\"pointer-events\", \"none\");\n\n    this.yAxis.append(\"line\").classed(\"bar\", true);\n    this.yAxis.append(\"text\").classed(\"low\", true);\n    this.yAxis.append(\"text\").classed(\"high\", true);\n\n    this.yAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.xAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.update();\n  }\n\n  /**\n   *\n   */\n  update() {\n    const { padding } = this.props;\n    this.g.attr(\"transform\", `translate(${padding.left} ${padding.top})`);\n\n    this.updateChart();\n    this.updateAxes();\n    this.updateCanvas();\n  }\n\n  /**\n   *\n   */\n  updateLine() {\n    const { dataFiltered, line, lineWidth } = this.props;\n    const lineBinding = this.chart.selectAll(\".line\").data([dataFiltered]);\n\n    const lineEnter = lineBinding\n      .enter()\n      .append(\"path\")\n      .classed(\"line\", true);\n\n    const lineMerged = lineEnter.merge(lineBinding);\n    lineMerged\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", \"#888\")\n      // .attr(\"stroke\", \"url(#svgGradient)\")\n      .attr(\"stroke-width\", lineWidth)\n      .attr(\"stroke-linejoin\", \"round\")\n      .attr(\"stroke-linecap\", \"round\")\n      .attr(\"pointer-events\", \"none\")\n      .attr(\"d\", line);\n\n    lineBinding.exit().remove();\n  }\n\n  /**\n   *\n   */\n  updateChart() {\n    const { dataFiltered, xValue, yValue, colorValue, radius } = this.props;\n\n    this.updateLine();\n\n    const binding = this.chart\n      .selectAll(\".dot\")\n      .data(dataFiltered, datum => datum.key);\n\n    const enter = binding\n      .enter()\n      .append(\"circle\")\n      .classed(\"dot\", true);\n\n    const merged = enter.merge(binding);\n\n    merged\n      .attr(\"cx\", xValue)\n      .attr(\"cy\", yValue)\n      .attr(\"r\", radius)\n      .attr(\"fill\", colorValue);\n    merged.style(\"pointer-events\", \"none\");\n\n    binding.exit().remove();\n  }\n\n  updateAxes() {\n    const {\n      xMetric,\n      yMetric,\n      xLabel,\n      yLabel,\n      plotHeight,\n      plotWidth,\n      padding\n    } = this.props;\n\n    this.xAxis.attr(\"transform\", `translate(${0}, ${plotHeight})`);\n    this.xAxis.attr(\"font-size\", 10).attr(\"fill\", \"none\");\n    this.yAxis.attr(\"font-size\", 10).attr(\"fill\", \"none\");\n\n    const xLowText = xMetric === \"gini\" ? \"more equal\" : \"low\";\n    const xHighText = xMetric === \"gini\" ? \"less equal\" : \"high\";\n\n    const yLowText = yMetric === \"gini\" ? \"more equal\" : \"low\";\n    const yHighText = yMetric === \"gini\" ? \"less equal\" : \"high\";\n\n    this.xAxis\n      .select(\".bar\")\n      .attr(\"x1\", 0)\n      .attr(\"x2\", plotWidth)\n      .attr(\"y1\", 0)\n      .attr(\"y2\", 0)\n      .style(\"stroke-width\", 1)\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", \"none\");\n\n    this.xAxis\n      .select(\".low\")\n      .attr(\"y\", 9)\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .text(xLowText);\n\n    this.xAxis\n      .select(\".high\")\n      .attr(\"y\", 9)\n      .attr(\"x\", plotWidth)\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .text(xHighText);\n\n    this.yAxis\n      .select(\".bar\")\n      .attr(\"x1\", 0)\n      .attr(\"x2\", 0)\n      .attr(\"y1\", 0)\n      .attr(\"y2\", plotHeight)\n      .style(\"stroke-width\", 1)\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", \"none\");\n\n    this.yAxis\n      .select(\".low\")\n      .attr(\"y\", 9)\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight} ${-padding.left + 18})`\n      )\n      .text(yLowText);\n\n    this.yAxis\n      .select(\".high\")\n      .attr(\"y\", 9)\n      .attr(\"x\", 0)\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .attr(\"transform\", `rotate(270) translate(${0} ${-padding.left + 18})`)\n      .text(yHighText);\n\n    this.yAxisLabel\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight / 2} ${-padding.left + 18})`\n      )\n      .text(yLabel);\n\n    this.xAxisLabel\n      .attr(\n        \"transform\",\n        `translate(${plotWidth / 2} ${plotHeight +\n          padding.top +\n          padding.bottom / 3})`\n      )\n      .text(xLabel);\n  }\n\n  /**\n   * Rerenders the chart on the canvas. Recomputes data sorting and scales.\n   */\n  updateCanvas() {\n    const {\n      dataBackground,\n      sizeScale,\n      width,\n      height,\n      padding,\n      lineWidth,\n      scale,\n      lineCanvas\n    } = this.props;\n\n    const color = d3.color(\"#ccc\");\n    color.opacity = scale === \"global\" ? 0.7 : 0.15;\n\n    // get context\n    const ctx = this.canvas.getContext(\"2d\");\n\n    lineCanvas.context(ctx);\n\n    // Reset transform to ensure scale setting is appropriate.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.scale(sizeScale, sizeScale);\n    // draw main bars\n    ctx.clearRect(0, 0, width, height);\n    // have some padding\n    ctx.translate(padding.left, padding.top);\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = color.toString();\n    dataBackground.forEach((country, index) => {\n      ctx.beginPath();\n      lineCanvas(country.valuesFilter);\n      ctx.stroke();\n    });\n  }\n\n  /**\n   *\n   */\n  updateAxesExact() {\n    const {\n      xAxis,\n      yAxis,\n      xLabel,\n      yLabel,\n      plotHeight,\n      plotWidth,\n      padding,\n      xScale,\n      yScale\n    } = this.props;\n\n    this.xAxis\n      .attr(\"transform\", `translate(${0}, ${plotHeight})`)\n      .call(xAxis.scale(xScale));\n\n    this.yAxis.call(yAxis.scale(yScale));\n\n    this.yAxisLabel\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight / 2} ${-padding.left + 18})`\n      )\n      .text(yLabel);\n\n    this.xAxisLabel\n      .attr(\n        \"transform\",\n        `translate(${plotWidth / 2} ${plotHeight +\n          padding.top +\n          padding.bottom / 3})`\n      )\n      .text(xLabel);\n  }\n\n  /**\n   *\n   */\n  render() {\n    const { name, height, width, sizeScale } = this.props;\n\n    let canvasStyle = {\n      width: width,\n      height: height\n    };\n\n    return (\n      <div className=\"ConnectedScatterPlot\">\n        <h4 className=\"title\">{name}</h4>\n        <div className=\"chart-container\">\n          <canvas\n            className=\"chart-canvas\"\n            ref={node => {\n              this.canvas = node;\n            }}\n            style={canvasStyle}\n            width={width * sizeScale}\n            height={height * sizeScale}\n          />\n          <svg\n            className=\"chart\"\n            ref={node => {\n              this.root = node;\n            }}\n            height={height}\n            width={width}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default addComputedProps(chartProps, {\n  changeInclude: [\n    \"data\",\n    \"dataBackground\",\n    \"scale\",\n    \"sortOrder\",\n    \"width\",\n    \"height\",\n    \"xMetric\",\n    \"yMetric\"\n  ]\n})(ConnectedScatterPlot);\n","import React, { Component } from \"react\";\nimport addComputedProps from \"react-computed-props\";\nimport * as d3 from \"d3\";\n\nimport \"./ColorLegend.scss\";\n\nfunction chartProps(props) {\n  const { domain } = props;\n  const years = d3.range(domain[0], domain[1] + 1, 2);\n  if (years[years.length - 1] !== domain[1]) {\n    years.push(domain[1]);\n  }\n  const radius = 8;\n  const spacer = 10;\n  const dotWidth = (radius * 2 + spacer) * years.length;\n  const xScale = d3\n    .scalePoint()\n    .domain(years)\n    .range([0, dotWidth]);\n  return { dotWidth, years, radius, xScale };\n}\n\nclass ColorLegend extends Component {\n  static defaultProps = {\n    height: 40\n  };\n\n  renderYear(year) {\n    const { xScale, radius, colorScale } = this.props;\n    return (\n      <g key={year} transform={`translate(${xScale(year)},${0})`}>\n        <text className=\"title\" textAnchor=\"middle\">\n          {year}\n        </text>\n        <circle cx={0} cy={13} r={radius} fill={colorScale(year)} />\n      </g>\n    );\n  }\n\n  render() {\n    const { years, dotWidth, height, radius } = this.props;\n    return (\n      <div className=\"ColorLegend\">\n        <svg className=\"dots\" width={dotWidth + radius * 4} height={height}>\n          <g transform={`translate(${radius * 2},${height / 4})`}>\n            {years.map(year => this.renderYear(year))}\n          </g>\n        </svg>\n      </div>\n    );\n  }\n}\n\nexport default addComputedProps(chartProps)(ColorLegend);\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport addComputedProps from \"react-computed-props\";\nimport { Row, Col } from \"reactstrap\";\nimport * as d3 from \"d3\";\nimport ConnectedScatterPlot from \"../ConnectedScatterPlot/ConnectedScatterPlot\";\nimport isfinite from \"lodash.isfinite\";\n\nimport ColorLegend from \"../ColorLegend/ColorLegend\";\nimport { tableContent } from \"../tooltip/tooltip\";\nimport { formatNumber } from \"../../utils/format\";\n\nimport \"./SmallMultipleConnected.scss\";\nimport AutoWidth from \"../AutoWidth/AutoWidth\";\n\nimport { METRICS, EXTENT } from \"../../constants\";\n\n/**\n *\n * @param {*} data\n * @param {*} sortOrder\n * @param {*} xFunc\n * @param {*} yFunc\n * @param {*} zFunc\n */\nfunction sortData(data, sortOrder, xFunc, yFunc, zFunc) {\n  if (METRICS[sortOrder]) {\n    const direction = sortOrder === \"gini\" ? \"ascending\" : \"descending\";\n    data = data.sort((x, y) =>\n      d3[direction](\n        x[METRICS[sortOrder].sortable],\n        y[METRICS[sortOrder].sortable]\n      )\n    );\n  } else if (sortOrder === \"region\") {\n    data = data.sort((x, y) => d3.ascending(x.region, y.region));\n  } else {\n    data = data.sort((x, y) => d3.ascending(x.key, y.key));\n  }\n\n  return data;\n}\n\n/**\n *\n * @param {*} data\n * @param {*} threshold\n * @param {*} xFunc\n * @param {*} yFunc\n */\nfunction filterData(data, threshold, xFunc, yFunc) {\n  return data.filter(country => {\n    country.valuesFilter = country.values.filter(year => {\n      return isfinite(xFunc(year)) && isfinite(yFunc(year));\n    });\n\n    return country.valuesFilter.length > threshold;\n  });\n}\n\n/**\n *\n * @param {*} props\n */\nfunction chartProps(props) {\n  const { xMetric, yMetric, scale, sortOrder } = props;\n  let { dataGrouped } = props;\n\n  const zMetric = \"year\";\n  const xLabel = METRICS[xMetric].label;\n  const yLabel = METRICS[yMetric].label;\n  const zLabel = METRICS[zMetric].label;\n\n  const xFunc = d => d[METRICS[xMetric][scale]];\n  const yFunc = d => d[METRICS[yMetric][scale]];\n  const zFunc = d => d[METRICS[zMetric].display];\n\n  dataGrouped = filterData(dataGrouped, 3, xFunc, yFunc);\n\n  dataGrouped = sortData(dataGrouped, sortOrder, xFunc, yFunc, zFunc);\n\n  // var colorScale = d3\n  //   .scaleSequential(d3.interpolatePlasma)\n  //   .domain([2020, 1995]);\n\n  const tooltipTextFunc = d => {\n    const tooltipData = {\n      [xLabel]: d[METRICS[xMetric].display],\n      [yLabel]: d[METRICS[yMetric].display]\n    };\n    return tableContent(tooltipData, {\n      title: `${d.year}`,\n      valueFormat: formatNumber\n    });\n  };\n\n  return {\n    dataGrouped,\n    xLabel,\n    yLabel,\n    zLabel,\n    xFunc,\n    yFunc,\n    zFunc,\n    tooltipTextFunc\n  };\n}\n\n/**\n *\n */\nclass SmallMultipleConnected extends Component {\n  static propTypes = {\n    dataGrouped: PropTypes.array,\n    scale: PropTypes.string,\n    sortOrder: PropTypes.string,\n    colorScale: PropTypes.func\n  };\n\n  static defaultProps = {\n    dataGrouped: [],\n    xMetric: \"hdi\",\n    yMetric: \"gni\",\n    scale: \"global\",\n    colorScale: d => \"#333\"\n  };\n\n  renderChart(chartData, chartIndex) {\n    const {\n      xFunc,\n      yFunc,\n      zFunc,\n      xLabel,\n      yLabel,\n      zLabel,\n      tooltipTextFunc,\n      xMetric,\n      yMetric,\n      scale,\n      colorScale,\n      dataGrouped\n    } = this.props;\n    return (\n      <Col sm={4} key={chartData.key}>\n        <AutoWidth>\n          <ConnectedScatterPlot\n            key={chartData.key}\n            name={chartData.key}\n            data={chartData.values}\n            xFunc={xFunc}\n            yFunc={yFunc}\n            zFunc={zFunc}\n            xLabel={xLabel}\n            yLabel={yLabel}\n            zLabel={zLabel}\n            xExtent={EXTENT}\n            yExtent={EXTENT}\n            tooltipTextFunc={tooltipTextFunc}\n            colorScale={colorScale}\n            xMetric={xMetric}\n            yMetric={yMetric}\n            scale={scale}\n            dataBackground={dataGrouped}\n          />\n        </AutoWidth>\n      </Col>\n    );\n  }\n\n  renderRegion(chartData, index) {\n    const { sortOrder, dataGrouped } = this.props;\n    const region = chartData.region;\n    if (sortOrder === \"region\") {\n      if (index === 0) {\n        return (\n          <Col sm={12} key={region}>\n            <h3 className=\"region\">{region}</h3>\n          </Col>\n        );\n      } else {\n        const preRegion = dataGrouped[index - 1].region;\n        if (region !== preRegion) {\n          return (\n            <Col key={region} sm={12}>\n              <h3 className=\"region\">{region}</h3>\n            </Col>\n          );\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   *\n   */\n  renderLegend() {\n    const { colorScale } = this.props;\n    return <ColorLegend colorScale={colorScale} domain={[2001, 2017]} />;\n  }\n\n  /**\n   *\n   */\n  render() {\n    const { dataGrouped } = this.props;\n    return (\n      <div className=\"SmallMultipleConnected\">\n        <Row>\n          <Col sm={6}>\n            <span className=\"align-middle\">\n              Data from 2000 to 2017 for {dataGrouped.length} countries.\n            </span>\n          </Col>\n          <Col sm={6}>{this.renderLegend()}</Col>\n        </Row>\n        <Row>\n          {dataGrouped.map((d, i) => [\n            this.renderRegion(d, i),\n            this.renderChart(d, i)\n          ])}\n        </Row>\n      </div>\n    );\n  }\n}\n\nexport default addComputedProps(chartProps)(SmallMultipleConnected);\n","import React, { Component } from \"react\";\nimport {\n  Dropdown,\n  DropdownToggle,\n  DropdownMenu,\n  DropdownItem\n} from \"reactstrap\";\n\nimport { CONFIGS } from \"../../constants\";\n\nimport \"./ConfigurePanel.scss\";\n\nfunction indexOf(key, objs) {\n  const keys = objs.map(o => o.id);\n  return keys.indexOf(key);\n}\n\nclass ConfigurePanel extends Component {\n  constructor(props) {\n    super(props);\n\n    console.log(props);\n\n    const { configs } = props;\n\n    this.toggle = this.toggle.bind(this);\n    this.click = this.click.bind(this);\n\n    const dataDisplayIndex = indexOf(\n      configs.dataDisplay,\n      CONFIGS.dataDisplay.options\n    );\n\n    this.state = {\n      dataDisplay: {\n        dropdownOpen: false,\n        selectIndex: dataDisplayIndex,\n        selectedId: CONFIGS.dataDisplay.options[dataDisplayIndex].id\n      },\n      sortOrder: {\n        dropdownOpen: false,\n        selectIndex: 0,\n        selectedId: CONFIGS.sortOrder.options[0].id\n      },\n      scale: {\n        dropdownOpen: false,\n        selectIndex: 0,\n        selectedId: CONFIGS.scale.options[0].id\n      }\n    };\n  }\n\n  /**\n   * When the react component updates, update the d3 vis\n   */\n  componentDidUpdate() {\n    const { configs } = this.props;\n    const { dataDisplay } = this.state;\n    const dataDisplayIndex = indexOf(\n      configs.dataDisplay,\n      CONFIGS.dataDisplay.options\n    );\n\n    if (dataDisplayIndex !== dataDisplay.selectIndex) {\n      dataDisplay.selectIndex = dataDisplayIndex;\n      dataDisplay.selectedId = CONFIGS.dataDisplay.options[dataDisplayIndex].id;\n      this.setState({ dataDisplay });\n    }\n  }\n\n  toggle(dropdownId) {\n    this.setState(prevState => {\n      const data = prevState[dropdownId];\n      data.dropdownOpen = !data.dropdownOpen;\n      return { [dropdownId]: data };\n    });\n  }\n\n  click(dropdownId, option, optionIndex) {\n    const { onClick } = this.props;\n    this.setState(prevState => {\n      const data = prevState[dropdownId];\n      data.selectIndex = optionIndex;\n      data.selectedId = option.id;\n      return { [dropdownId]: data };\n    });\n\n    if (onClick) {\n      onClick(dropdownId, option.id);\n    }\n  }\n\n  renderDropdown(dropdownId) {\n    const dropdownState = this.state[dropdownId];\n    const data = CONFIGS[dropdownId];\n    const items = data.options.map((d, index) => (\n      <DropdownItem\n        key={d.id}\n        onClick={this.click.bind(this, dropdownId, d, index)}\n      >\n        {d.label}\n      </DropdownItem>\n    ));\n\n    const display = data.options[dropdownState.selectIndex];\n\n    return (\n      <Dropdown\n        isOpen={this.state[dropdownId].dropdownOpen}\n        toggle={this.toggle.bind(this, dropdownId)}\n      >\n        <DropdownToggle caret>{display.label}</DropdownToggle>\n        <DropdownMenu>{items}</DropdownMenu>\n      </Dropdown>\n    );\n  }\n\n  render() {\n    const { size } = this.props;\n    if (size === \"small\") {\n      return (\n        <div className=\"ConfigurePanel\">\n          Showing {this.renderDropdown(\"dataDisplay\")}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"ConfigurePanel\">\n        Showing {this.renderDropdown(\"dataDisplay\")} sorted{\" \"}\n        {this.renderDropdown(\"sortOrder\")} using a{\" \"}\n        {this.renderDropdown(\"scale\")} scale.\n      </div>\n    );\n  }\n}\nexport default ConfigurePanel;\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport addComputedProps from \"react-computed-props\";\nimport * as d3 from \"d3\";\nimport isfinite from \"lodash.isfinite\";\nimport { floatingTooltip } from \"../tooltip/tooltip\";\n\nimport \"./ConnectedScatterPlotGroups.scss\";\n\nfunction isHoverEqual(a, b) {\n  if (!a && !b) {\n    return true;\n  }\n\n  if (!a && b) {\n    return false;\n  }\n  if (a && !b) {\n    return false;\n  }\n\n  return a.key === b.key;\n}\n\n/**\n *\n * @param {*} props\n */\nfunction chartProps(props) {\n  const {\n    dataBackground,\n    xFunc,\n    yFunc,\n    zFunc,\n    colorScale,\n    height,\n    width,\n    scale\n  } = props;\n\n  let { xExtent, yExtent } = props;\n\n  const threshold = 3;\n\n  const padding = {\n    top: 20,\n    right: 20,\n    bottom: 40,\n    left: 40\n  };\n\n  // scaling for retina displays\n  let sizeScale = 1.0;\n  if (window.devicePixelRatio) {\n    sizeScale = window.devicePixelRatio;\n  }\n\n  const radius = scale === \"local\" ? 5 : 2;\n  const lineWidth = scale === \"local\" ? 3 : 1;\n\n  const plotWidth = width - padding.left - padding.right;\n  const plotHeight = height - padding.top - padding.bottom;\n\n  let allData = [];\n\n  dataBackground.forEach(country => {\n    country.valuesFilter = country.values.filter(\n      datum => isfinite(xFunc(datum)) && isfinite(yFunc(datum))\n    );\n\n    if (country.valuesFilter.length > threshold) {\n      allData = allData.concat(country.valuesFilter);\n    }\n\n    country.meanX = d3.mean(country.valuesFilter, xFunc);\n    country.meanY = d3.mean(country.valuesFilter, yFunc);\n\n    if (!xExtent) {\n      country.minX = d3.min(country.valuesFilter, xFunc);\n      country.maxX = d3.max(country.valuesFilter, xFunc);\n    }\n\n    if (!yExtent) {\n      country.minY = d3.min(country.valuesFilter, yFunc);\n      country.maxY = d3.max(country.valuesFilter, yFunc);\n    }\n  });\n\n  if (!xExtent) {\n    const xMin = d3.min(dataBackground, d => d.minX);\n    const xMax = d3.max(dataBackground, d => d.maxX);\n    xExtent = [xMin, xMax];\n  }\n\n  if (!yExtent) {\n    const yMin = d3.min(dataBackground, d => d.minY);\n    const yMax = d3.max(dataBackground, d => d.maxY);\n    yExtent = [yMin, yMax];\n  }\n\n  const xScale = d3\n    .scaleLinear()\n    .domain(xExtent)\n    .range([0, plotWidth]);\n\n  const yScale = d3\n    .scaleLinear()\n    .domain(yExtent)\n    .range([plotHeight, 0]);\n\n  const xValue = d => xScale(xFunc(d));\n  const yValue = d => yScale(yFunc(d));\n\n  const line = d3\n    .line()\n    .x(xValue)\n    .y(yValue)\n    .curve(d3.curveCardinal.tension(0.3));\n\n  const lineCanvas = d3\n    .line()\n    .x(xValue)\n    .y(yValue)\n    .curve(d3.curveCardinal.tension(0.3));\n\n  let colorValue = d => \"#ddd\";\n  if (colorScale) {\n    colorValue = d => colorScale(zFunc(d));\n  }\n\n  let voronoiDiagram = null;\n  const pixelJitter = () => Math.random() - 0.5;\n  voronoiDiagram = d3\n    .voronoi()\n    .x(d => xValue(d) + pixelJitter())\n    .y(d => yValue(d) + pixelJitter())\n    .size([plotWidth, plotHeight])(allData);\n\n  const mouseRadius = plotWidth / 10;\n\n  const yAxis = d3.axisLeft(yScale).tickSizeOuter(0);\n  const xAxis = d3.axisBottom(xScale).tickSizeOuter(0);\n\n  return {\n    line,\n    lineCanvas,\n    threshold,\n    padding,\n    plotHeight,\n    plotWidth,\n    xScale,\n    yScale,\n    xValue,\n    yValue,\n    colorValue,\n    radius,\n    lineWidth,\n    voronoiDiagram,\n    mouseRadius,\n    xAxis,\n    yAxis,\n    sizeScale\n  };\n}\n\n/**\n *\n */\nclass ConnectedScatterPlotGroups extends Component {\n  static propTypes = {\n    data: PropTypes.array,\n    name: PropTypes.string,\n    radius: PropTypes.number,\n    scale: PropTypes.string,\n    xFunc: PropTypes.func,\n    yFunc: PropTypes.func,\n    xLabel: PropTypes.string,\n    yLabel: PropTypes.string,\n    xExtent: PropTypes.array,\n    yExtent: PropTypes.array,\n    width: PropTypes.number,\n    height: PropTypes.number,\n    tooltipTextFunc: PropTypes.func\n  };\n\n  static defaultProps = {\n    data: [],\n    radius: 4,\n    height: 300,\n    width: 300,\n    name: \"\",\n    xFunc: d => d.x,\n    yFunc: d => d.x,\n    xLabel: \"\",\n    yLabel: \"\",\n    tooltipTextFunc: d => \"\",\n    colorScale: () => \"#ddd\"\n  };\n\n  /**\n   *\n   */\n  constructor(props) {\n    super(props);\n    this.state = { hover: null };\n\n    this.handleMouseover = this.handleMouseover.bind(this);\n    this.handleMouseout = this.handleMouseout.bind(this);\n    this.highlightCircle = this.highlightCircle.bind(this);\n  }\n\n  /**\n   * When the react component mounts, setup the d3 vis\n   */\n  componentDidMount() {\n    this.setup();\n  }\n\n  /**\n   * When the react component updates, update the d3 vis\n   */\n  componentDidUpdate() {\n    this.update();\n  }\n\n  /**\n   *\n   */\n  handleMouseover(el) {\n    const { voronoiDiagram, mouseRadius } = this.props;\n\n    let mousePos = d3.mouse(el);\n    mousePos = this.zoomTransform.invert(mousePos);\n    const site = voronoiDiagram.find(mousePos[0], mousePos[1], mouseRadius);\n    this.highlightCircle(site && site.data);\n  }\n\n  /**\n   *\n   */\n  handleMouseout(el) {\n    this.highlightCircle(null);\n  }\n\n  /**\n   *\n   */\n  highlightCircle(d) {\n    const {\n      xFunc,\n      yFunc,\n      colorScale,\n      colorBy,\n      tooltipTextFunc,\n      onHover\n    } = this.props;\n\n    let { xScale, yScale } = this.props;\n    const { hover } = this.state;\n\n    xScale = this.zoomTransform.rescaleX(xScale);\n    yScale = this.zoomTransform.rescaleY(yScale);\n\n    if (!d) {\n      this.highlight.style(\"display\", \"none\");\n      this.tooltip.hideTooltip();\n    } else {\n      this.highlight\n        .style(\"display\", \"\")\n        .style(\"stroke\", colorScale(d[colorBy]))\n        .attr(\"cx\", xScale(xFunc(d)))\n        .attr(\"cy\", yScale(yFunc(d)));\n      if (tooltipTextFunc) {\n        this.tooltip.showTooltip(tooltipTextFunc(d), d3.event);\n      }\n    }\n\n    if (!isHoverEqual(hover, d)) {\n      this.setState({ hover: d });\n    }\n\n    if (onHover) {\n      onHover(d);\n    }\n  }\n\n  /**\n   *\n   */\n  setup() {\n    const { plotWidth, plotHeight, radius } = this.props;\n\n    this.zoomTransform = d3.zoomIdentity;\n\n    const cRoot = d3.select(this.root);\n\n    this.g = cRoot.append(\"g\");\n\n    const that = this;\n    this.underlay = this.g\n      .append(\"rect\")\n      .classed(\"underlay\", true)\n      .attr(\"width\", plotWidth)\n      .attr(\"height\", plotHeight)\n      .style(\"fill\", \"white\")\n      .style(\"opacity\", 0.0001)\n      .on(\"mousemove\", function(d) {\n        that.handleMouseover(this, d);\n      })\n      .on(\"mouseleave\", function() {\n        that.handleMouseout();\n      });\n    this.chart = this.g.append(\"g\").classed(\"chart-group\", true);\n    this.tooltip = floatingTooltip(\"_tooltip\");\n\n    this.highlight = this.g\n      .append(\"circle\")\n      .attr(\"class\", \"highlight-circle\")\n      .attr(\"r\", radius + 2)\n      .style(\"fill\", \"none\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"display\", \"none\");\n\n    this.xAxis = this.g\n      .append(\"g\")\n      .classed(\"x-axis\", true)\n      .style(\"pointer-events\", \"none\");\n\n    this.xAxis.append(\"line\").classed(\"bar\", true);\n    this.xAxis.append(\"text\").classed(\"low\", true);\n    this.xAxis.append(\"text\").classed(\"high\", true);\n\n    this.yAxis = this.g\n      .append(\"g\")\n      .classed(\"y-axis\", true)\n      .style(\"pointer-events\", \"none\");\n\n    this.yAxis.append(\"line\").classed(\"bar\", true);\n    this.yAxis.append(\"text\").classed(\"low\", true);\n    this.yAxis.append(\"text\").classed(\"high\", true);\n\n    this.yAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.xAxisLabel = this.g\n      .append(\"text\")\n      .attr(\"class\", \"axis-label\")\n      .attr(\"text-anchor\", \"middle\");\n\n    this.update();\n  }\n\n  /**\n   *\n   */\n  update() {\n    const { padding } = this.props;\n    this.g.attr(\"transform\", `translate(${padding.left} ${padding.top})`);\n\n    this.updateAxes();\n    this.updateCanvas();\n  }\n\n  /**\n   *\n   */\n  updateLine() {\n    const { dataFiltered, line, lineWidth } = this.props;\n    const lineBinding = this.chart.selectAll(\".line\").data([dataFiltered]);\n\n    const lineEnter = lineBinding\n      .enter()\n      .append(\"path\")\n      .classed(\"line\", true);\n\n    const lineMerged = lineEnter.merge(lineBinding);\n    lineMerged\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", \"#888\")\n      // .attr(\"stroke\", \"url(#svgGradient)\")\n      .attr(\"stroke-width\", lineWidth)\n      .attr(\"stroke-linejoin\", \"round\")\n      .attr(\"stroke-linecap\", \"round\")\n      .attr(\"pointer-events\", \"none\")\n      .attr(\"d\", line);\n\n    lineBinding.exit().remove();\n  }\n\n  /**\n   *\n   */\n  updateChart() {\n    const { dataFiltered, xValue, yValue, colorValue, radius } = this.props;\n\n    this.updateLine();\n\n    const binding = this.chart\n      .selectAll(\".dot\")\n      .data(dataFiltered, datum => datum.key);\n\n    const enter = binding\n      .enter()\n      .append(\"circle\")\n      .classed(\"dot\", true);\n\n    const merged = enter.merge(binding);\n\n    merged\n      .attr(\"cx\", xValue)\n      .attr(\"cy\", yValue)\n      .attr(\"r\", radius)\n      .attr(\"fill\", colorValue);\n    merged.style(\"pointer-events\", \"none\");\n\n    binding.exit().remove();\n  }\n\n  updateAxes() {\n    const {\n      xMetric,\n      yMetric,\n      xLabel,\n      yLabel,\n      plotHeight,\n      plotWidth,\n      padding\n    } = this.props;\n\n    this.xAxis.attr(\"transform\", `translate(${0}, ${plotHeight})`);\n    this.xAxis.attr(\"font-size\", 10).attr(\"fill\", \"none\");\n    this.yAxis.attr(\"font-size\", 10).attr(\"fill\", \"none\");\n\n    const xLowText = xMetric === \"gini\" ? \"more equal\" : \"low\";\n    const xHighText = xMetric === \"gini\" ? \"less equal\" : \"high\";\n\n    const yLowText = yMetric === \"gini\" ? \"more equal\" : \"low\";\n    const yHighText = yMetric === \"gini\" ? \"less equal\" : \"high\";\n\n    this.xAxis\n      .select(\".bar\")\n      .attr(\"x1\", 0)\n      .attr(\"x2\", plotWidth)\n      .attr(\"y1\", 0)\n      .attr(\"y2\", 0)\n      .style(\"stroke-width\", 1)\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", \"none\");\n\n    this.xAxis\n      .select(\".low\")\n      .attr(\"y\", 9)\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .text(xLowText);\n\n    this.xAxis\n      .select(\".high\")\n      .attr(\"y\", 9)\n      .attr(\"x\", plotWidth)\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .text(xHighText);\n\n    this.yAxis\n      .select(\".bar\")\n      .attr(\"x1\", 0)\n      .attr(\"x2\", 0)\n      .attr(\"y1\", 0)\n      .attr(\"y2\", plotHeight)\n      .style(\"stroke-width\", 1)\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", \"none\");\n\n    this.yAxis\n      .select(\".low\")\n      .attr(\"y\", 9)\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight} ${-padding.left + 18})`\n      )\n      .text(yLowText);\n\n    this.yAxis\n      .select(\".high\")\n      .attr(\"y\", 9)\n      .attr(\"x\", 0)\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"fill\", \"#333\")\n      .attr(\"dy\", \"0.6em\")\n      .attr(\"transform\", `rotate(270) translate(${0} ${-padding.left + 18})`)\n      .text(yHighText);\n\n    this.yAxisLabel\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight / 2} ${-padding.left + 18})`\n      )\n      .text(yLabel);\n\n    this.xAxisLabel\n      .attr(\n        \"transform\",\n        `translate(${plotWidth / 2} ${plotHeight +\n          padding.top +\n          padding.bottom / 3})`\n      )\n      .text(xLabel);\n  }\n\n  /**\n   * Rerenders the chart on the canvas. Recomputes data sorting and scales.\n   */\n  updateCanvas() {\n    const {\n      dataBackground,\n      sizeScale,\n      width,\n      height,\n      padding,\n      lineWidth,\n      scale,\n      lineCanvas,\n      xValue,\n      yValue,\n      radius,\n      colorValue,\n      threshold\n    } = this.props;\n\n    const { hover } = this.state;\n\n    // get context\n    const ctx = this.canvas.getContext(\"2d\");\n\n    lineCanvas.context(ctx);\n\n    // Reset transform to ensure scale setting is appropriate.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.scale(sizeScale, sizeScale);\n    // draw main bars\n    ctx.clearRect(0, 0, width, height);\n    // have some padding\n    ctx.translate(padding.left, padding.top);\n    ctx.lineWidth = lineWidth;\n\n    let lineColor = d3.color(\"#ccc\");\n    lineColor.opacity = scale === \"global\" ? 0.8 : 0.15;\n    ctx.strokeStyle = lineColor.toString();\n\n    let hoverCountry = null;\n\n    dataBackground.forEach((country, index) => {\n      if (hover && hover.country === country.key) {\n        hoverCountry = country;\n      }\n      if (country.valuesFilter.length > threshold) {\n        ctx.beginPath();\n        lineCanvas(country.valuesFilter);\n        ctx.stroke();\n\n        country.valuesFilter.forEach(year => {\n          let dotColor = lineColor;\n          if (!hover) {\n            dotColor = colorValue(year);\n          }\n          ctx.beginPath();\n          ctx.arc(xValue(year), yValue(year), radius, 0, 2 * Math.PI, false);\n          ctx.fillStyle = dotColor.toString();\n          ctx.fill();\n        });\n      }\n    });\n\n    lineColor = d3.color(\"#888\");\n    lineColor.opacity = scale === \"global\" ? 0.8 : 0.15;\n    ctx.strokeStyle = lineColor.toString();\n\n    if (hoverCountry) {\n      ctx.beginPath();\n      lineCanvas(hoverCountry.valuesFilter);\n      ctx.stroke();\n\n      hoverCountry.valuesFilter.forEach(year => {\n        const dotColor = colorValue(year);\n        ctx.beginPath();\n        ctx.arc(xValue(year), yValue(year), radius, 0, 2 * Math.PI, false);\n        ctx.fillStyle = dotColor.toString();\n        ctx.fill();\n      });\n    }\n  }\n\n  /**\n   *\n   */\n  updateAxesExact() {\n    const {\n      xAxis,\n      yAxis,\n      xLabel,\n      yLabel,\n      plotHeight,\n      plotWidth,\n      padding,\n      xScale,\n      yScale\n    } = this.props;\n\n    this.xAxis\n      .attr(\"transform\", `translate(${0}, ${plotHeight})`)\n      .call(xAxis.scale(xScale));\n\n    this.yAxis.call(yAxis.scale(yScale));\n\n    this.yAxisLabel\n      .attr(\n        \"transform\",\n        `rotate(270) translate(${-plotHeight / 2} ${-padding.left + 18})`\n      )\n      .text(yLabel);\n\n    this.xAxisLabel\n      .attr(\n        \"transform\",\n        `translate(${plotWidth / 2} ${plotHeight +\n          padding.top +\n          padding.bottom / 3})`\n      )\n      .text(xLabel);\n  }\n\n  /**\n   *\n   */\n  render() {\n    const { name, height, width, sizeScale } = this.props;\n\n    let canvasStyle = {\n      width: width,\n      height: height\n    };\n\n    return (\n      <div className=\"ConnectedScatterPlotGroups\">\n        <h4 className=\"title\">{name}</h4>\n        <div className=\"chart-container\">\n          <canvas\n            className=\"chart-canvas\"\n            ref={node => {\n              this.canvas = node;\n            }}\n            style={canvasStyle}\n            width={width * sizeScale}\n            height={height * sizeScale}\n          />\n          <svg\n            className=\"chart\"\n            ref={node => {\n              this.root = node;\n            }}\n            height={height}\n            width={width}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default addComputedProps(chartProps, {\n  changeInclude: [\n    \"dataBackground\",\n    \"scale\",\n    \"sortOrder\",\n    \"width\",\n    \"height\",\n    \"xMetric\",\n    \"yMetric\"\n  ]\n})(ConnectedScatterPlotGroups);\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport addComputedProps from \"react-computed-props\";\nimport AutoWidth from \"../AutoWidth/AutoWidth\";\nimport ConnectedScatterPlotGroups from \"../ConnectedScatterPlotGroups/ConnectedScatterPlotGroups\";\n\nimport { tableContent } from \"../tooltip/tooltip\";\nimport { formatNumber } from \"../../utils/format\";\nimport { METRICS, EXTENT } from \"../../constants\";\n\nfunction chartProps(props) {\n  const { xMetric, yMetric } = props;\n  const scale = \"global\";\n\n  const zMetric = \"year\";\n  const xLabel = METRICS[xMetric].label;\n  const yLabel = METRICS[yMetric].label;\n  const zLabel = METRICS[zMetric].label;\n  const xFunc = d => d[METRICS[xMetric][scale]];\n  const yFunc = d => d[METRICS[yMetric][scale]];\n  const zFunc = d => d[METRICS[zMetric].display];\n\n  const tooltipTextFunc = d => {\n    const tooltipData = {\n      [xLabel]: d[METRICS[xMetric].display],\n      [yLabel]: d[METRICS[yMetric].display]\n    };\n    return tableContent(tooltipData, {\n      title: `${d.country} - ${d.year}`,\n      valueFormat: formatNumber\n    });\n  };\n\n  return {\n    scale,\n    xLabel,\n    yLabel,\n    zLabel,\n    xFunc,\n    yFunc,\n    zFunc,\n    tooltipTextFunc\n  };\n}\n\nclass BigGraph extends Component {\n  static propTypes = {\n    dataGrouped: PropTypes.array,\n    scale: PropTypes.string,\n    colorScale: PropTypes.func\n  };\n\n  static defaultProps = {\n    dataGrouped: [],\n    xMetric: \"hdi\",\n    yMetric: \"gni\",\n    scale: \"global\",\n    colorScale: d => \"#333\"\n  };\n\n  /**\n   *\n   */\n  renderBigGraph() {\n    const {\n      dataGrouped,\n      colorScale,\n      scale,\n      xLabel,\n      yLabel,\n      zLabel,\n      xFunc,\n      yFunc,\n      zFunc,\n      xMetric,\n      yMetric,\n      tooltipTextFunc\n    } = this.props;\n\n    return (\n      <AutoWidth>\n        <ConnectedScatterPlotGroups\n          dataBackground={dataGrouped}\n          xMetric={xMetric}\n          yMetric={yMetric}\n          xFunc={xFunc}\n          yFunc={yFunc}\n          zFunc={zFunc}\n          xLabel={xLabel}\n          yLabel={yLabel}\n          zLabel={zLabel}\n          xExtent={EXTENT}\n          yExtent={EXTENT}\n          scale={scale}\n          colorScale={colorScale}\n          height={600}\n          tooltipTextFunc={tooltipTextFunc}\n        />\n      </AutoWidth>\n    );\n  }\n\n  render() {\n    return this.renderBigGraph();\n  }\n}\n\nexport default addComputedProps(chartProps)(BigGraph);\n","import React, { Component } from \"react\";\nimport * as d3 from \"d3\";\nimport { Container, Row, Col } from \"reactstrap\";\n\nimport AutoWidth from \"../AutoWidth/AutoWidth\";\nimport ScatterPlot from \"../ScatterPlot/ScatterPlot\";\nimport { tableContent } from \"../tooltip/tooltip\";\nimport { formatNumber, roundNumber } from \"../../utils/format\";\nimport { METRICS, SCATTER_LABELS } from \"../../constants\";\nimport SmallMultipleConnected from \"../SmallMultipleConnected/SmallMultipleConnected\";\nimport ConfigurePanel from \"../ConfigurePanel/ConfigurePanel\";\nimport ColorLegend from \"../ColorLegend/ColorLegend\";\n\nimport \"./App.scss\";\nimport BigGraph from \"../BigGraph/BigGraph\";\n\n/**\n *\n */\nfunction getData() {\n  const changesPath = `${process.env.PUBLIC_URL}/data/gov_data_year.csv`;\n  return d3.csv(changesPath);\n}\n\nconst STRING_COLUMNS = [\"country\", \"iso3c\", \"iso2c\", \"region\", \"sub-region\"];\nconst ROUND_COLUMNS = {\n  gdp_per_cap: { decimals: 0 }\n};\nconst NULL_STRING = \"NA\";\n\n/**\n *\n */\nfunction normalizeMinMax(data, attr, normAttr) {\n  const minData = d3.min(data, d => d[attr]);\n  const maxData = d3.max(data, d => d[attr]);\n  data.forEach(datum => {\n    datum[normAttr] = datum[attr]\n      ? (datum[attr] - minData) / (maxData - minData)\n      : NaN;\n  });\n\n  return data;\n}\n\n/**\n *\n * @param {*} data\n */\nfunction processData(data) {\n  data.forEach(datum => {\n    Object.keys(datum).forEach(key => {\n      if (!STRING_COLUMNS.includes(key)) {\n        datum[key] = datum[key] === NULL_STRING ? null : +datum[key];\n      }\n      if (ROUND_COLUMNS[key]) {\n        datum[key] = datum[key]\n          ? roundNumber(datum[key], ROUND_COLUMNS[key].decimals)\n          : null;\n      }\n    });\n\n    datum.key = `${datum.country}:${datum.year}`;\n  });\n\n  // FILTER LOW POPULATION\n  const MIN_POP = 5000000;\n  data = data.filter(d => d.population > MIN_POP);\n\n  normalizeMinMax(data, \"hdi\", \"hdi_norm\");\n  normalizeMinMax(data, \"gni_per_cap\", \"gni_norm\");\n  normalizeMinMax(data, \"efree\", \"efree_norm\");\n  normalizeMinMax(data, \"gdp_per_cap\", \"gdp_norm\");\n  normalizeMinMax(data, \"gini\", \"gini_norm\");\n\n  // nest by country to get normalized by country\n  const dataByCountry = d3\n    .nest()\n    .key(d => d.country)\n    .entries(data);\n\n  dataByCountry.forEach(country => {\n    normalizeMinMax(country.values, \"gdp_per_cap\", \"gdp_norm_local\");\n    normalizeMinMax(country.values, \"gni_per_cap\", \"gni_norm_local\");\n    normalizeMinMax(country.values, \"hdi\", \"hdi_norm_local\");\n    normalizeMinMax(country.values, \"efree\", \"efree_norm_local\");\n    normalizeMinMax(country.values, \"gini\", \"gini_norm_local\");\n  });\n\n  return data;\n}\n\n/**\n *\n * @param {*} data\n */\nfunction groupData(data) {\n  let dataGrouped = d3\n    .nest()\n    .key(d => d.country)\n    .entries(data);\n\n  return dataGrouped;\n}\n\n/**\n *\n * @param {*} data\n */\nfunction processGroupedData(data) {\n  data.forEach(country => {\n    country.region = country.values[0].region || \"Other\";\n    country[METRICS[\"gdp\"].sortable] = d3.max(\n      country.values,\n      d => d[METRICS[\"gdp\"][\"display\"]]\n    );\n    country[METRICS[\"hdi\"].sortable] = d3.max(\n      country.values,\n      d => d[METRICS[\"hdi\"][\"display\"]]\n    );\n    country[METRICS[\"efree\"].sortable] = d3.max(\n      country.values,\n      d => d[METRICS[\"efree\"][\"display\"]]\n    );\n    country[METRICS[\"gini\"].sortable] = d3.min(\n      country.values,\n      d => d[METRICS[\"gini\"][\"display\"]]\n    );\n  });\n  return data;\n}\n\n/**\n *\n */\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: [],\n      dataGrouped: [],\n      focusYear: 2017,\n      scatterHover: null,\n      configs: {\n        dataDisplay: \"hdi_gdp\",\n        sortOrder: \"hdi\",\n        scale: \"local\"\n      },\n      colorScale: d3.scaleSequential(d3.interpolateOranges).domain([1990, 2020])\n    };\n\n    this.handleScatterHover = this.handleScatterHover.bind(this);\n    this.handleConfigClick = this.handleConfigClick.bind(this);\n  }\n\n  /**\n   *\n   * @param {*} hoverData\n   */\n  handleScatterHover(hoverData) {\n    const { scatterHover } = this.state;\n\n    if (hoverData) {\n      if (!scatterHover || !scatterHover.values.includes(hoverData.key)) {\n        this.setState({ scatterHover: { values: [hoverData.key] } });\n      }\n    } else {\n      this.setState({ scatterHover: null });\n    }\n  }\n\n  handleConfigClick(configId, valueId) {\n    const { configs } = this.state;\n    configs[configId] = valueId;\n    this.setState({ configs });\n  }\n\n  /**\n   *\n   */\n  componentDidMount() {\n    getData()\n      .then(processData)\n      .then(data => {\n        let dataGrouped = groupData(data);\n        dataGrouped = processGroupedData(dataGrouped);\n        this.setState({ data, dataGrouped });\n      });\n  }\n\n  /**\n   *\n   */\n  renderScatterGNIvsKDI() {\n    const { data, focusYear, scatterHover } = this.state;\n    const displayData = data.filter(d => d.year === focusYear);\n    const yFunc = d => d.hdi;\n    const xFunc = d => d.gdp_per_cap;\n\n    const xLabel = \"GDP per Capita\";\n    const yLabel = \"Human Development Index\";\n\n    const tooltipTextFunc = d => {\n      const tooltipData = { [xLabel]: xFunc(d), [yLabel]: yFunc(d) };\n      return tableContent(tooltipData, {\n        title: d.country,\n        valueFormat: formatNumber\n      });\n    };\n\n    return (\n      <AutoWidth>\n        <ScatterPlot\n          data={displayData}\n          xFunc={xFunc}\n          yFunc={yFunc}\n          xLabel={xLabel}\n          yLabel={yLabel}\n          hoverData={scatterHover}\n          tooltipTextFunc={tooltipTextFunc}\n          onHover={this.handleScatterHover}\n          labels={SCATTER_LABELS.hdi}\n        />\n      </AutoWidth>\n    );\n  }\n\n  /**\n   *\n   */\n  renderScatterGNIvsEfree() {\n    const { data, focusYear, scatterHover } = this.state;\n    const displayData = data.filter(d => d.year === focusYear);\n    const xFunc = d => d.gdp_per_cap;\n    const yFunc = d => d.efree;\n\n    const xLabel = \"GDP per Capita\";\n    const yLabel = \"Economic Freedom Score\";\n\n    const tooltipTextFunc = d => {\n      const tooltipData = { [xLabel]: xFunc(d), [yLabel]: yFunc(d) };\n      return tableContent(tooltipData, {\n        title: d.country,\n        valueFormat: formatNumber\n      });\n    };\n\n    return (\n      <AutoWidth>\n        <ScatterPlot\n          data={displayData}\n          xFunc={xFunc}\n          yFunc={yFunc}\n          xLabel={xLabel}\n          yLabel={yLabel}\n          hoverData={scatterHover}\n          tooltipTextFunc={tooltipTextFunc}\n          onHover={this.handleScatterHover}\n          labels={SCATTER_LABELS.efree}\n        />\n      </AutoWidth>\n    );\n  }\n\n  /**\n   *\n   */\n  renderBigGraph() {\n    const { data, dataGrouped, configs, colorScale } = this.state;\n    const [yMetric, xMetric] = configs.dataDisplay.split(\"_\");\n\n    return (\n      <BigGraph\n        data={data}\n        dataGrouped={dataGrouped}\n        colorScale={colorScale}\n        xMetric={xMetric}\n        yMetric={yMetric}\n      />\n    );\n  }\n\n  /**\n   *\n   */\n  renderSmallMult() {\n    const { dataGrouped, configs, colorScale } = this.state;\n\n    const [yMetric, xMetric] = configs.dataDisplay.split(\"_\");\n\n    return (\n      <SmallMultipleConnected\n        dataGrouped={dataGrouped}\n        xMetric={xMetric}\n        yMetric={yMetric}\n        scale={configs.scale}\n        sortOrder={configs.sortOrder}\n        colorScale={colorScale}\n      />\n    );\n  }\n\n  /**\n   *\n   */\n  renderConfigPanel(size = null) {\n    const { configs } = this.state;\n    return (\n      <ConfigurePanel\n        configs={configs}\n        size={size}\n        onClick={this.handleConfigClick}\n      />\n    );\n  }\n\n  /**\n   *\n   */\n  renderLegend() {\n    const { colorScale } = this.state;\n    return <ColorLegend colorScale={colorScale} domain={[2001, 2017]} />;\n  }\n\n  /**\n   *\n   */\n  render() {\n    return (\n      <div className=\"App\">\n        <Container>\n          <Row>\n            <Col>\n              <div className=\"top-bar\">\n                <a\n                  className=\"align-middle float-right\"\n                  href=\"http://vallandingham.me/\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  vallandingham.me\n                </a>\n              </div>\n            </Col>\n          </Row>\n          <Row>\n            <Col>\n              <h1>Good Governments Help People to Succeed</h1>\n              <h5 className=\"author\">by Jim Vallandingham</h5>\n            </Col>\n          </Row>\n          <Row>\n            <Col sm={2} />\n            <Col sm={9}>\n              <div className=\"blank\" />\n              <p>\n                This visual exploration looks at answering the question of what\n                makes a <strong>good government</strong> from an individual's\n                perspective.\n              </p>\n              <p>\n                When thinking of the attributes that make a government “good”,\n                it is easy to fall back on a commonly used measurement like the{\" \"}\n                <strong>Gross Domestic Product (GDP)</strong> that showcase a\n                government’s power and progress. The GDP measures the value of\n                goods and services produced in a period of time. It ranks\n                countries, and their governments, by output, with more output\n                being associated with a “better” government.\n              </p>\n\n              <p>\n                While the top economic progress is a tempting answer for what\n                makes a government successful, metrics like the GDP{\" \"}\n                <strong>fail</strong> to explain what makes a government good or\n                bad for the <strong>individuals</strong> living under that\n                government. A high GDP doesn’t necessarily mean a high quality\n                of life.\n              </p>\n              <p>\n                We, as governed people, need to take a more nuanced look at the\n                quality of government, through the lense of social well-being\n                and enablement of individual progress.\n              </p>\n\n              <blockquote cite=\"Thomas Jefferson\">\n                The care of human life and happiness, and not their destruction,\n                is the first and only object of good government.\n              </blockquote>\n\n              <p>\n                This true purpose of government, to improve human life, is\n                nothing new. Thomas Jefferson, the principal author of the\n                Declaration of Independence and the third president of the\n                United States said as much during his lifetime.\n              </p>\n            </Col>\n          </Row>\n          <Row>\n            <Col>\n              <h2>New Metrics to Understand Progress</h2>\n            </Col>\n          </Row>\n          <Row>\n            <Col sm={2} />\n            <Col sm={9}>\n              <div className=\"line\" />\n              <p>\n                From a data perspective, many organizations and researchers have\n                developed a variety of metrics that can be used to better\n                understand a government’s individual impact. We will focus on\n                just a few.\n              </p>\n              <p>\n                The <strong>Human Development Index (HDI)</strong> combines\n                statistics on life expectancy, education, and income per capita\n                to rank countries into tiers of development. This index provides\n                a measure of how good a government is at enabling individuals to\n                do the things they want to do, and be the people they want to\n                be.\n              </p>\n              <p>\n                The <strong>Economic Freedom Score</strong>, calculated by the\n                Heritage Foundation, tracks how well a government enables an\n                individual the freedom to work, produce, consume, and invest in\n                any way they please.\n              </p>\n              <p>\n                The <strong>Gini Index</strong> is a measure of inequality in\n                the distribution of individual or family income. A{\" \"}\n                <strong>lower</strong> value indicates a more equal distribution\n                of wealth.\n              </p>\n              <p>\n                The good news is that these metrics are correlated with more\n                performance metrics like GDP.\n              </p>\n            </Col>\n          </Row>\n          <Row>\n            <Col md={6}>{this.renderScatterGNIvsKDI()}</Col>\n            <Col md={6}>{this.renderScatterGNIvsEfree()}</Col>\n          </Row>\n          <Row>\n            <Col sm={2} />\n            <Col sm={9}>\n              <div className=\"blank\" />\n              <p>\n                Governments <strong>can</strong> achieve success in being good\n                for both the individuals being governed, and good in the amount\n                of wealth produced.\n              </p>\n              <div className=\"blank\" />\n            </Col>\n          </Row>\n          <Row>\n            <Col>\n              <h2>Progress Over Time</h2>\n            </Col>\n          </Row>\n          <Row>\n            <Col sm={2} />\n            <Col sm={9}>\n              <div className=\"line\" />\n              <p>\n                This simple snapshot of government performance on these metrics\n                is useful, but what is perhaps more interesting is a country’s\n                progress over time, and how values for an individual country\n                change year by year.\n              </p>\n              <p>\n                The visualization below allows comparison and exploration of\n                these metrics through <strong>connected scatterplots</strong>{\" \"}\n                for each country.\n              </p>\n              <p>\n                The graphs use the x and y dimensions to plot different metric\n                values, with each year of data displayed connected together by a\n                line. Data from all countries is displayed in the background in\n                grey for comparison. Display options allow us to find\n                connections between countries and patterns within a country,\n                both at a global scale, and also at a country-level scale for\n                seeing year-to-year changes up close. After exploring the\n                visualization{\" \"}\n                <a\n                  href=\"http://vallandingham.me/world_gov_challenge/analysis.nb.html\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  check out the analysis behind it\n                </a>\n                .\n              </p>\n              <p>\n                With this visualization, we can see the progress of the\n                governments of the world toward or away from what is good for\n                their peoples, as well as what is good for economic growth.\n              </p>\n            </Col>\n          </Row>\n          <Row>\n            <Col sm={12}>\n              <div className=\"blank\" />\n              <h2>Connected Countries</h2>\n            </Col>\n          </Row>\n          <Row>\n            <Col sm={6}>{this.renderConfigPanel(\"small\")}</Col>\n            <Col sm={6}>{this.renderLegend()}</Col>\n          </Row>\n          <Row>\n            <Col sm={12}>{this.renderBigGraph()}</Col>\n          </Row>\n          <Row>\n            <div className=\"blank\" />\n            <Col sm={12}>{this.renderConfigPanel()}</Col>\n          </Row>\n\n          <Row>\n            <Col sm={12}>{this.renderSmallMult()}</Col>\n          </Row>\n          <Row>\n            <Col sm={12} className=\"footer\">\n              <p>\n                Jim Vallandingham |{\" \"}\n                <a href=\"http://vallandingham.me\">vallandingham.me</a> |{\" \"}\n                <a href=\"http://vallandingham.me/world_gov_challenge/analysis.nb.html\">\n                  Analysis\n                </a>{\" \"}\n                | Developed for the{\" \"}\n                <a href=\"https://wdvp.worldgovernmentsummit.org/\">\n                  World Data Visualization Prize\n                </a>\n              </p>\n            </Col>\n          </Row>\n        </Container>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./custom.scss\";\nimport \"./index.scss\";\nimport App from \"./components/App/App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}